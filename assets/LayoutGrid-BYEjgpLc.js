import{initPyodide as b,getPyodide as M}from"./pyodide-DnLQs2a6.js";import{j as f,r as J}from"./index-f6dHBdSQ.js";function y(o){return typeof o=="number"?String(o):`(${o.map(n=>y(n)).join(", ")})`}async function W(o){await b();const a=M();try{const n=a.runPython(`
from cute_layout.layout_string_parser import parse_layout_string
import json

layout_str = ${JSON.stringify(o)}
parsed = parse_layout_string(layout_str)
result = {
    "shape": parsed["shape"],
    "stride": parsed["stride"]
}
json.dumps(result)
    `);return JSON.parse(n)}catch(n){throw new Error(`Failed to parse layout: ${n}`)}}async function q(o,a,n,i){await b();const e=M();try{const r=y(o),s=y(a),c=y(n),l=y(i),t=e.runPython(`
from cute_layout.layout import Layout
from cute_layout.composition import composition as py_composition
import json

outer = Layout(${r}, ${s})
inner = Layout(${c}, ${l})
result_layout = py_composition(outer, inner)

result = {
    "shape": result_layout.shape,
    "stride": result_layout.stride
}
json.dumps(result)
    `);return JSON.parse(t)}catch(r){throw new Error(`Failed to compute composition: ${r}`)}}async function L(o,a){await b();const n=M();try{const i=y(o),e=y(a);return n.runPython(`
from cute_layout.utils import calculate_offset
calculate_offset(${i}, ${e})
    `)}catch(i){throw new Error(`Failed to calculate offset: ${i}`)}}async function K(o,a){await b();const n=M();try{const i=y(a),e=n.runPython(`
from cute_layout.utils import offset_to_coordinate
import json
coords = offset_to_coordinate(${o}, ${i})
json.dumps(coords)
    `);return JSON.parse(e)}catch(i){throw new Error(`Failed to convert offset to coordinate: ${i}`)}}async function A(o,a=!1){await b();const n=M();try{const i=y(o),e=n.runPython(`
from cute_layout.utils import generate_coordinates
import json
coords = generate_coordinates(${i}, flat=${a?"True":"False"})
json.dumps(coords)
    `);return JSON.parse(e)}catch(i){throw new Error(`Failed to generate coordinates: ${i}`)}}async function F(o){await b();const a=M();try{const n=y(o);return a.runPython(`
from cute_layout.utils import count_elements
count_elements(${n})
    `)}catch(n){throw new Error(`Failed to count elements: ${n}`)}}async function D(o,a){await b();const n=M();try{const i=y(o),e=y(a),r=n.runPython(`
from cute_layout.layout import Layout
import json
layout = Layout(${i}, ${e})
coord_list = layout.offset_to_coord_list()
json.dumps(coord_list)
    `);return JSON.parse(r)}catch(i){throw new Error(`Failed to get offset to coord list: ${i}`)}}function k(o){return typeof o=="number"?o:o.length===1?k(o[0]):o.map(k)}function j(o){const a=k(o);return typeof a=="number"?String(a):a.every(i=>typeof i=="number")?`(${a.join(",")})`:`(${a.map(j).join(",")})`}async function Q(o,a){const n=(p,h)=>{if(typeof p=="number"){if(isNaN(p))throw new Error(`${h} must be a number`);if(h==="Shape"&&p<=0)throw new Error("Shape must be positive integers")}else Array.isArray(p)&&p.forEach(g=>n(g,h))};n(o,"Shape"),n(a,"Stride");const i=Array.isArray(o)?o.length:1;let e=1,r=1;const s=[],c=[],l=[];if(i===2&&Array.isArray(o)&&Array.isArray(a)){const p=o[0],h=o[1],g=a[0],_=a[1];e=await F(p),r=await F(h);const C=await A(p),P=await A(h);for(let m=0;m<C.length;m++){const u=C[m],v=await L(u,g);c.length<e&&c.push(j(u));for(let $=0;$<P.length;$++){const d=P[$],x=await L(d,_),w=v+x;m===0&&l.length<r&&l.push(j(d));const S=[u,d];s.push({row:m,col:$,offset:w,coords:S})}}}else{e=1;const p=await A(o);r=p.length;for(let h=0;h<p.length;h++){const g=p[h],_=await L(g,a);l.push(j(g)),s.push({row:0,col:h,offset:_,coords:g})}}const t=await D(o,a);return{gridData:s,rows:e,cols:r,parsedLayout:{shape:o,stride:a},colCoords:l,rowCoords:c,offsetToCoordList:t}}function G(o){return Array.isArray(o)?`(${o.map(G).join(",")})`:String(o)}function V(o,a,n,i,e=!0){if(!e)return"#ffffff";if(n===a)return"rgb(255, 255, 200)";const r=(o-a)/(n-a);let s,c,l;switch(i){case"viridis":{if(r<.25){const t=r/.25;s=Math.floor(68+-9*t),c=Math.floor(1+81*t),l=Math.floor(84+55*t)}else if(r<.5){const t=(r-.25)/.25;s=Math.floor(59+-26*t),c=Math.floor(82+63*t),l=Math.floor(139+1*t)}else if(r<.75){const t=(r-.5)/.25;s=Math.floor(33+61*t),c=Math.floor(145+56*t),l=Math.floor(140+-42*t)}else{const t=(r-.75)/.25;s=Math.floor(94+159*t),c=Math.floor(201+30*t),l=Math.floor(98+-61*t)}break}case"heat":{if(r<.25){const t=r/.25;s=Math.floor(255*t),c=0,l=0}else if(r<.5){const t=(r-.25)/.25;s=255,c=Math.floor(165*t),l=0}else if(r<.75){const t=(r-.5)/.25;s=255,c=Math.floor(165+90*t),l=0}else{const t=(r-.75)/.25;s=255,c=255,l=Math.floor(255*t)}break}case"grayscale":{const t=Math.floor(255*r);s=t,c=t,l=t;break}default:{if(r<.25){const t=r/.25;s=0,c=Math.floor(128+127*t),l=255}else if(r<.5){const t=(r-.25)/.25;s=0,c=255,l=Math.floor(255*(1-t))}else if(r<.75){const t=(r-.5)/.25;s=Math.floor(255*t),c=255,l=0}else{const t=(r-.75)/.25;s=255,c=Math.floor(255*(1-t)),l=0}break}}return`rgb(${s}, ${c}, ${l})`}function O(o){const n=[];for(let i=0;i<20;i++){const e=i/19;let r,s,c;switch(o){case"viridis":if(e<.25){const t=e/.25;r=Math.floor(68+-9*t),s=Math.floor(1+81*t),c=Math.floor(84+55*t)}else if(e<.5){const t=(e-.25)/.25;r=Math.floor(59+-26*t),s=Math.floor(82+63*t),c=Math.floor(139+1*t)}else if(e<.75){const t=(e-.5)/.25;r=Math.floor(33+61*t),s=Math.floor(145+56*t),c=Math.floor(140+-42*t)}else{const t=(e-.75)/.25;r=Math.floor(94+159*t),s=Math.floor(201+30*t),c=Math.floor(98+-61*t)}break;case"heat":if(e<.25){const t=e/.25;r=Math.floor(255*t),s=0,c=0}else if(e<.5){const t=(e-.25)/.25;r=255,s=Math.floor(165*t),c=0}else if(e<.75){const t=(e-.5)/.25;r=255,s=Math.floor(165+90*t),c=0}else{const t=(e-.75)/.25;r=255,s=255,c=Math.floor(255*t)}break;case"grayscale":const l=Math.floor(255*e);r=l,s=l,c=l;break;default:if(e<.25){const t=e/.25;r=0,s=Math.floor(128+127*t),c=255}else if(e<.5){const t=(e-.25)/.25;r=0,s=255,c=Math.floor(255*(1-t))}else if(e<.75){const t=(e-.5)/.25;r=Math.floor(255*t),s=255,c=0}else{const t=(e-.75)/.25;r=255,s=Math.floor(255*(1-t)),c=0}break}n.push(`rgb(${r}, ${s}, ${c})`)}return`linear-gradient(to right, ${n.join(", ")})`}function R(o,a=!0){if(!a)return"#000000";const n=o.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(!n)return"#000000";const[,i,e,r]=n.map(Number);return(.299*i+.587*e+.114*r)/255>.5?"#000000":"#ffffff"}function U({heatmapEnabled:o,colorScheme:a,minOffset:n,maxOffset:i,onHeatmapToggle:e,onColorSchemeChange:r}){return f.jsxs("div",{className:"mb-4 flex gap-4 items-center flex-wrap pb-4 border-b border-gray-200",children:[f.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[f.jsx("input",{type:"checkbox",checked:o,onChange:s=>e(s.target.checked),className:"w-4 h-4 cursor-pointer"}),f.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Heatmap View"})]}),o&&f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Color Scheme:"}),f.jsxs("select",{value:a,onChange:s=>r(s.target.value),className:"px-3 py-1.5 border-2 border-gray-300 rounded focus:border-blue-500 focus:outline-none text-sm cursor-pointer",children:[f.jsx("option",{value:"viridis",children:"Viridis (Recommended)"}),f.jsx("option",{value:"rainbow",children:"Rainbow"}),f.jsx("option",{value:"heat",children:"Heat"}),f.jsx("option",{value:"grayscale",children:"Grayscale"})]}),f.jsx("div",{className:"h-5 rounded border border-gray-300 ml-2",style:{width:"120px",background:O(a)},title:`Color gradient from ${n} to ${i}`})]})]})}const z=J.forwardRef(({grid:o,title:a,showCoords:n,hoveredCell:i=null,hoveredOffset:e=null,highlightedCells:r=new Set,onCellHover:s,onCellLeave:c,onOffsetHover:l,cellRefs:t,cellRefsByOffset:p,heatmapEnabled:h=!1,colorScheme:g="viridis",minOffset:_=0,maxOffset:C=0},P)=>o.gridData.length===0?null:f.jsxs("div",{ref:P,className:"bg-white rounded-lg shadow p-4 overflow-x-auto",children:[f.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-3 font-mono text-center",children:a}),f.jsxs("div",{className:"inline-block min-w-full",children:[f.jsx("div",{className:"flex",style:{marginLeft:o.rows>1?"50px":"0"},children:o.colCoords.map((m,u)=>f.jsx("div",{className:`text-center font-mono text-[10px] flex-shrink-0 transition-colors flex items-center justify-center ${i&&i.col===u?"bg-gray-300":"text-gray-600"}`,style:{width:"33px",minHeight:"24px",marginRight:u<o.colCoords.length-1?"1px":"0"},children:m},u))}),f.jsxs("div",{className:"flex",children:[o.rows>1&&f.jsx("div",{className:"flex flex-col",children:o.rowCoords.map((m,u)=>f.jsx("div",{className:`flex items-center justify-end pr-1 font-mono text-[10px] transition-colors ${i&&i.row===u?"bg-gray-300":"text-gray-600"}`,style:{height:"33px",width:"50px",marginBottom:u<o.rowCoords.length-1?"1px":"0"},children:m},u))}),f.jsx("div",{className:"grid",style:{gridTemplateColumns:`repeat(${o.cols}, 33px)`,gap:"1px"},children:Array.from({length:o.rows*o.cols},(m,u)=>{const v=Math.floor(u/o.cols),$=u%o.cols,d=o.gridData.find(N=>N.row===v&&N.col===$);if(!d)return null;const x=i?.row===d.row&&i?.col===d.col,w=e!==null&&d.offset===e,S=r.has(`${d.row},${d.col}`),H=n&&n[u]!==void 0?j(n[u]):d.offset.toString(),E=h?V(d.offset,_,C,g,!0):x||w?"#dbeafe":S?"#fef08a":"#ffffff",T=h?R(E,!0):"#000000";return f.jsx("div",{ref:N=>{t?.current&&(t.current[u]=N),p?.current&&p.current.set(d.offset,N)},className:"flex items-center justify-center font-mono text-[11px] cursor-pointer transition-all",style:{width:"33px",height:"33px",border:x||w?"2px solid #3b82f6":"1px solid #999",backgroundColor:E,color:T,fontWeight:x||w||S?"bold":"normal",transform:x||w?"scale(1.05)":"scale(1)",zIndex:x||w?10:S?5:1,boxShadow:x||w?"0 2px 8px rgba(59, 130, 246, 0.5)":"none"},onMouseEnter:()=>{s?.(d.row,d.col),l?.(d.offset)},onMouseLeave:()=>{c?.(),l?.(null)},title:n?`Offset: ${d.offset}
Coord: ${j(n[u])}`:`Offset: ${d.offset}`,children:H},u)})})]})]})]}));z.displayName="LayoutGrid";export{U as H,z as L,L as a,q as c,j as f,Q as g,K as o,W as p,G as t};
