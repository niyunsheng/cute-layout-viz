import{r as t,j as e,u as M}from"./index-f6dHBdSQ.js";import{f as D,H,L as I,t as E,p as O,g as T}from"./LayoutGrid-BYEjgpLc.js";import"./pyodide-DnLQs2a6.js";function B({offsetToCoordList:d,hoveredOffset:n,onOffsetHover:g,gridCellRefs:u,listItemRefs:h}){const b=t.useRef(null),w=t.useRef(new Map),[c,m]=t.useState(null),p=h||w;return t.useEffect(()=>{if(n===null||!u?.current){m(null);return}const a=p.current?.get(n),o=u.current.get(n);if(!a||!o){m(null);return}const f=()=>{const s=a.getBoundingClientRect(),r=o.getBoundingClientRect();m({x1:s.left+s.width/2,y1:s.top,x2:r.left+r.width/2,y2:r.bottom})},y=b.current;let v=!1;if(y){const s=y.getBoundingClientRect(),r=a.getBoundingClientRect();(r.top<s.top||r.bottom>s.bottom)&&(v=!0,a.scrollIntoView({behavior:"smooth",block:"nearest"}))}if(v){let s;const r=performance.now(),C=500,x=()=>{f(),performance.now()-r<C&&(s=requestAnimationFrame(x))};return s=requestAnimationFrame(x),()=>{cancelAnimationFrame(s)}}else requestAnimationFrame(f)},[n,u,p]),d.length===0?null:e.jsxs("div",{className:"relative",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Offset → Coordinate"}),e.jsx("div",{ref:b,className:"flex flex-wrap gap-1 p-2 bg-gray-50 rounded border max-h-40 overflow-y-auto",children:d.map((a,o)=>e.jsx("div",{ref:f=>{p.current?.set(o,f)},className:`
              px-2 py-1 rounded text-xs font-mono cursor-pointer transition-all
              ${n===o?"bg-blue-500 text-white ring-2 ring-blue-300":a===null?"bg-gray-200 text-gray-400":"bg-white border border-gray-300 hover:border-blue-400"}
            `,onMouseEnter:()=>a!==null&&g(o),onMouseLeave:()=>g(null),title:a!==null?`Offset ${o} → ${D(a)}`:`Offset ${o} (unused)`,children:a!==null?D(a):"∅"},o))}),c&&e.jsx("svg",{className:"fixed inset-0 pointer-events-none z-50",style:{width:"100vw",height:"100vh"},children:e.jsx("line",{x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2,stroke:"#3b82f6",strokeWidth:"2",strokeDasharray:"5,5"})})]})}function F(){const[d]=M(),[n,g]=t.useState(()=>d.get("layout")||"(12,(4,8)):(59,(13,1))"),[u,h]=t.useState(""),[b,w]=t.useState(null),[c,m]=t.useState(null),[p,a]=t.useState(!1),[o,f]=t.useState(!0),[y,v]=t.useState("viridis"),[s,r]=t.useState({gridData:[],rows:0,cols:0,parsedLayout:null,colCoords:[],rowCoords:[],offsetToCoordList:[]}),[C,x]=t.useState(0),[R,L]=t.useState(0),j=t.useRef(new Map),N=t.useRef(new Map);return t.useEffect(()=>{const l=d.get("layout");l&&(g(l),h(""))},[d]),t.useEffect(()=>{(async()=>{try{const i=await O(n);h("");const S=await T(i.shape,i.stride);if(r(S),S.gridData.length>0){const k=S.gridData.map($=>$.offset);x(Math.min(...k)),L(Math.max(...k))}else x(0),L(0);j.current.clear(),N.current.clear()}catch(i){h(i instanceof Error?i.message:"Unknown error"),r({gridData:[],rows:0,cols:0,parsedLayout:null,colCoords:[],rowCoords:[],offsetToCoordList:[]}),x(0),L(0)}})()},[n]),e.jsxs("div",{className:"max-w-6xl p-0 leading-relaxed text-black",children:[e.jsx("h1",{className:"text-4xl m-0 text-black mb-6",children:"Layout"}),e.jsxs("div",{className:"max-w-full",children:[e.jsx("div",{className:"mb-4 max-w-4xl",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-3 mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Layout Input (Shape:Stride)"}),e.jsx("input",{type:"text",value:n,onChange:l=>g(l.target.value),className:"w-full px-3 py-2 border-2 border-gray-300 rounded focus:border-blue-500 focus:outline-none font-mono",placeholder:"e.g., (9,(4,8)):(59,(13,1))"}),u&&e.jsxs("div",{className:"mt-2 text-red-600 text-sm font-medium",children:["⚠️ ",u]}),!u&&s.parsedLayout&&e.jsx("button",{onClick:()=>{const i=`${`${window.location.origin}${window.location.pathname}`}#/layout?layout=${n}`;navigator.clipboard.writeText(i).then(()=>{a(!0),setTimeout(()=>a(!1),2e3)})},className:"mt-3 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded font-medium transition-colors",children:p?"✓ Link copied!":"Share This Layout"})]})}),s.gridData.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 overflow-x-auto",children:[e.jsx(H,{heatmapEnabled:o,colorScheme:y,minOffset:C,maxOffset:R,onHeatmapToggle:f,onColorSchemeChange:v}),e.jsx(I,{grid:s,title:`Layout(${E(s.parsedLayout?.shape)}:${E(s.parsedLayout?.stride)})`,hoveredCell:b,hoveredOffset:c,onCellHover:(l,i)=>w({row:l,col:i}),onCellLeave:()=>w(null),onOffsetHover:m,cellRefsByOffset:j,heatmapEnabled:o,colorScheme:y,minOffset:C,maxOffset:R}),e.jsx("div",{className:"mt-4",children:e.jsx(B,{offsetToCoordList:s.offsetToCoordList,hoveredOffset:c,onOffsetHover:m,gridCellRefs:j,listItemRefs:N})})]})]})]})}export{F as default};
