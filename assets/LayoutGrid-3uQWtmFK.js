import{initPyodide as b,getPyodide as M}from"./pyodide-GADaI8Wc.js";import{j as f,r as E}from"./index-CyG5ptUr.js";function m(o){return typeof o=="number"?String(o):`(${o.map(s=>m(s)).join(", ")})`}async function T(o){await b();const i=M();try{const s=i.runPython(`
from cute_layout.layout_string_parser import parse_layout_string
import json

layout_str = ${JSON.stringify(o)}
parsed = parse_layout_string(layout_str)
result = {
    "shape": parsed["shape"],
    "stride": parsed["stride"]
}
json.dumps(result)
    `);return JSON.parse(s)}catch(s){throw new Error(`Failed to parse layout: ${s}`)}}async function V(o,i,s,l){await b();const r=M();try{const e=m(o),n=m(i),a=m(s),c=m(l),t=r.runPython(`
from cute_layout.layout import Layout
from cute_layout.composition import composition as py_composition
import json

outer = Layout(${e}, ${n})
inner = Layout(${a}, ${c})
result_layout = py_composition(outer, inner)

result = {
    "shape": result_layout.shape,
    "stride": result_layout.stride
}
json.dumps(result)
    `);return JSON.parse(t)}catch(e){throw new Error(`Failed to compute composition: ${e}`)}}async function C(o,i){await b();const s=M();try{const l=m(o),r=m(i);return s.runPython(`
from cute_layout.utils import calculate_offset
calculate_offset(${l}, ${r})
    `)}catch(l){throw new Error(`Failed to calculate offset: ${l}`)}}async function z(o,i){await b();const s=M();try{const l=m(i),r=s.runPython(`
from cute_layout.utils import offset_to_coordinate
import json
coords = offset_to_coordinate(${o}, ${l})
json.dumps(coords)
    `);return JSON.parse(r)}catch(l){throw new Error(`Failed to convert offset to coordinate: ${l}`)}}async function P(o,i=!1){await b();const s=M();try{const l=m(o),r=s.runPython(`
from cute_layout.utils import generate_coordinates
import json
coords = generate_coordinates(${l}, flat=${i?"True":"False"})
json.dumps(coords)
    `);return JSON.parse(r)}catch(l){throw new Error(`Failed to generate coordinates: ${l}`)}}async function k(o){await b();const i=M();try{const s=m(o);return i.runPython(`
from cute_layout.utils import count_elements
count_elements(${s})
    `)}catch(s){throw new Error(`Failed to count elements: ${s}`)}}function N(o){return typeof o=="number"?String(o):o.every(s=>typeof s=="number")?`(${o.join(",")})`:`(${o.map(N).join(",")})`}async function I(o,i){const s=(t,d)=>{if(typeof t=="number"){if(isNaN(t))throw new Error(`${d} must be a number`);if(d==="Shape"&&t<=0)throw new Error("Shape must be positive integers")}else Array.isArray(t)&&t.forEach(y=>s(y,d))};s(o,"Shape"),s(i,"Stride");const l=Array.isArray(o)?o.length:1;let r=1,e=1;const n=[],a=[],c=[];if(l===2&&Array.isArray(o)&&Array.isArray(i)){const t=o[0],d=o[1],y=i[0],$=i[1];r=await k(t),e=await k(d);const g=await P(t),u=await P(d);for(let x=0;x<g.length;x++){const j=g[x],h=await C(j,y);a.length<r&&a.push(N(j));for(let p=0;p<u.length;p++){const w=u[p],v=await C(w,$),_=h+v;x===0&&c.length<e&&c.push(N(w)),n.push({row:x,col:p,offset:_,coords:[j,w]})}}}else{r=1;const t=await P(o);e=t.length;for(let d=0;d<t.length;d++){const y=t[d],$=await C(y,i);c.push(N(y)),n.push({row:0,col:d,offset:$,coords:y})}}return{gridData:n,rows:r,cols:e,parsedLayout:{shape:o,stride:i},colCoords:c,rowCoords:a}}function H(o){return Array.isArray(o)?`(${o.map(H).join(",")})`:String(o)}function F(o,i,s,l,r=!0){if(!r)return"#ffffff";if(s===i)return"rgb(255, 255, 200)";const e=(o-i)/(s-i);let n,a,c;switch(l){case"viridis":{if(e<.25){const t=e/.25;n=Math.floor(68+-9*t),a=Math.floor(1+81*t),c=Math.floor(84+55*t)}else if(e<.5){const t=(e-.25)/.25;n=Math.floor(59+-26*t),a=Math.floor(82+63*t),c=Math.floor(139+1*t)}else if(e<.75){const t=(e-.5)/.25;n=Math.floor(33+61*t),a=Math.floor(145+56*t),c=Math.floor(140+-42*t)}else{const t=(e-.75)/.25;n=Math.floor(94+159*t),a=Math.floor(201+30*t),c=Math.floor(98+-61*t)}break}case"heat":{if(e<.25){const t=e/.25;n=Math.floor(255*t),a=0,c=0}else if(e<.5){const t=(e-.25)/.25;n=255,a=Math.floor(165*t),c=0}else if(e<.75){const t=(e-.5)/.25;n=255,a=Math.floor(165+90*t),c=0}else{const t=(e-.75)/.25;n=255,a=255,c=Math.floor(255*t)}break}case"grayscale":{const t=Math.floor(255*e);n=t,a=t,c=t;break}default:{if(e<.25){const t=e/.25;n=0,a=Math.floor(128+127*t),c=255}else if(e<.5){const t=(e-.25)/.25;n=0,a=255,c=Math.floor(255*(1-t))}else if(e<.75){const t=(e-.5)/.25;n=Math.floor(255*t),a=255,c=0}else{const t=(e-.75)/.25;n=255,a=Math.floor(255*(1-t)),c=0}break}}return`rgb(${n}, ${a}, ${c})`}function D(o){const s=[];for(let l=0;l<20;l++){const r=l/19;let e,n,a;switch(o){case"viridis":if(r<.25){const t=r/.25;e=Math.floor(68+-9*t),n=Math.floor(1+81*t),a=Math.floor(84+55*t)}else if(r<.5){const t=(r-.25)/.25;e=Math.floor(59+-26*t),n=Math.floor(82+63*t),a=Math.floor(139+1*t)}else if(r<.75){const t=(r-.5)/.25;e=Math.floor(33+61*t),n=Math.floor(145+56*t),a=Math.floor(140+-42*t)}else{const t=(r-.75)/.25;e=Math.floor(94+159*t),n=Math.floor(201+30*t),a=Math.floor(98+-61*t)}break;case"heat":if(r<.25){const t=r/.25;e=Math.floor(255*t),n=0,a=0}else if(r<.5){const t=(r-.25)/.25;e=255,n=Math.floor(165*t),a=0}else if(r<.75){const t=(r-.5)/.25;e=255,n=Math.floor(165+90*t),a=0}else{const t=(r-.75)/.25;e=255,n=255,a=Math.floor(255*t)}break;case"grayscale":const c=Math.floor(255*r);e=c,n=c,a=c;break;default:if(r<.25){const t=r/.25;e=0,n=Math.floor(128+127*t),a=255}else if(r<.5){const t=(r-.25)/.25;e=0,n=255,a=Math.floor(255*(1-t))}else if(r<.75){const t=(r-.5)/.25;e=Math.floor(255*t),n=255,a=0}else{const t=(r-.75)/.25;e=255,n=Math.floor(255*(1-t)),a=0}break}s.push(`rgb(${e}, ${n}, ${a})`)}return`linear-gradient(to right, ${s.join(", ")})`}function G(o,i=!0){if(!i)return"#000000";const s=o.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(!s)return"#000000";const[,l,r,e]=s.map(Number);return(.299*l+.587*r+.114*e)/255>.5?"#000000":"#ffffff"}function B({heatmapEnabled:o,colorScheme:i,minOffset:s,maxOffset:l,onHeatmapToggle:r,onColorSchemeChange:e}){return f.jsxs("div",{className:"mb-4 flex gap-4 items-center flex-wrap pb-4 border-b border-gray-200",children:[f.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[f.jsx("input",{type:"checkbox",checked:o,onChange:n=>r(n.target.checked),className:"w-4 h-4 cursor-pointer"}),f.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Heatmap View"})]}),o&&f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Color Scheme:"}),f.jsxs("select",{value:i,onChange:n=>e(n.target.value),className:"px-3 py-1.5 border-2 border-gray-300 rounded focus:border-blue-500 focus:outline-none text-sm cursor-pointer",children:[f.jsx("option",{value:"viridis",children:"Viridis (Recommended)"}),f.jsx("option",{value:"rainbow",children:"Rainbow"}),f.jsx("option",{value:"heat",children:"Heat"}),f.jsx("option",{value:"grayscale",children:"Grayscale"})]}),f.jsx("div",{className:"h-5 rounded border border-gray-300 ml-2",style:{width:"120px",background:D(i)},title:`Color gradient from ${s} to ${l}`})]})]})}function A(o){return typeof o=="number"?String(o):o.every(s=>typeof s=="number")?`(${o.join(",")})`:`(${o.map(A).join(",")})`}const J=E.forwardRef(({grid:o,title:i,showCoords:s,hoveredCell:l=null,highlightedCells:r=new Set,onCellHover:e,onCellLeave:n,cellRefs:a,heatmapEnabled:c=!1,colorScheme:t="viridis",minOffset:d=0,maxOffset:y=0},$)=>o.gridData.length===0?null:f.jsxs("div",{ref:$,className:"bg-white rounded-lg shadow p-4 overflow-x-auto",children:[f.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-3 font-mono text-center",children:i}),f.jsxs("div",{className:"inline-block min-w-full",children:[f.jsx("div",{className:"flex",style:{marginLeft:o.rows>1?"50px":"0"},children:o.colCoords.map((g,u)=>f.jsx("div",{className:`text-center font-mono text-[10px] flex-shrink-0 transition-colors flex items-center justify-center ${l&&l.col===u?"bg-gray-300":"text-gray-600"}`,style:{width:"33px",minHeight:"24px",marginRight:u<o.colCoords.length-1?"1px":"0"},children:g},u))}),f.jsxs("div",{className:"flex",children:[o.rows>1&&f.jsx("div",{className:"flex flex-col",children:o.rowCoords.map((g,u)=>f.jsx("div",{className:`flex items-center justify-end pr-1 font-mono text-[10px] transition-colors ${l&&l.row===u?"bg-gray-300":"text-gray-600"}`,style:{height:"33px",width:"50px",marginBottom:u<o.rowCoords.length-1?"1px":"0"},children:g},u))}),f.jsx("div",{className:"grid",style:{gridTemplateColumns:`repeat(${o.cols}, 33px)`,gap:"1px"},children:Array.from({length:o.rows*o.cols},(g,u)=>{const x=Math.floor(u/o.cols),j=u%o.cols,h=o.gridData.find(S=>S.row===x&&S.col===j);if(!h)return null;const p=l?.row===h.row&&l?.col===h.col,w=r.has(`${h.row},${h.col}`),v=s&&s[u]!==void 0?A(s[u]):h.offset.toString(),_=c?F(h.offset,d,y,t,!0):p?"#dbeafe":w?"#fef08a":"#ffffff",L=c?G(_,!0):"#000000";return f.jsx("div",{ref:S=>{a&&(a.current[u]=S)},className:"flex items-center justify-center font-mono text-[11px] cursor-pointer transition-all",style:{width:"33px",height:"33px",border:p?"2px solid #3b82f6":"1px solid #999",backgroundColor:_,color:L,fontWeight:p||w?"bold":"normal",transform:p?"scale(1.05)":"scale(1)",zIndex:p?10:w?5:1,boxShadow:p?"0 2px 8px rgba(59, 130, 246, 0.5)":"none"},onMouseEnter:()=>e?.(h.row,h.col),onMouseLeave:()=>n?.(),title:s?`Offset: ${h.offset}
Coord: ${A(s[u])}`:`Offset: ${h.offset}`,children:v},u)})})]})]})]}));J.displayName="LayoutGrid";export{B as H,J as L,C as a,V as c,I as g,z as o,T as p,H as t};
